# 智能对话训练平台 v2.0 - 完整使用指南

## 📋 平台概述

智能对话训练平台是基于RASA的智能对话模型训练和管理平台，支持指令库管理、模型训练、测试验证、版本管理等完整功能，现已全面支持双屏数据处理和追问逻辑。

### 🎯 核心功能
- **指令库母版管理**: 支持多业务、多语种、多版本
- **指令数据管理**: 完整的指令和相似问管理
- **词槽管理**: 智能词槽定义和实体值管理
- **双屏数据处理**: 支持双屏Excel格式的指令和词槽导入 ✨
- **追问逻辑**: 完整的词槽填充和追问机制 ✨
- **模型训练**: 异步训练和进度监控
- **指令测试**: 批量测试和准确率分析
- **版本管理**: 模型版本对比和激活管理
- **系统监控**: 真实系统性能监控

## 🚀 快速启动

### 🎯 智能启动系统 (推荐) ✨

#### 代码修改后重启服务
```bash
# 智能重启：自动检测并重启所有服务（无需手动停止）
scripts\restart_all_services.bat
```

#### 首次启动或正常启动
```bash
# 方式1: 批处理文件（最简单，会智能检测现有服务）
start_all_services.bat

# 方式2: Python脚本（跨平台）
python start_all_services.py

# 方式3: 使用scripts目录（智能检测版）
scripts\start_all_services.bat
```

#### 完全停止所有服务
```bash
# 一键停止所有服务
scripts\stop_all_services.bat
```

### 单独启动服务

#### 启动后端服务
```bash
cd backend
venv\Scripts\activate
python app.py
```

#### 启动Rasa服务
```bash
# 简化版启动（推荐，快速）
python scripts\start_rasa_simple.py

# GPU加速版启动（需要NVIDIA GPU）
python scripts\start_rasa_gpu.py
```

#### 启动前端服务
```bash
cd frontend
npm start
```

### 💡 智能服务管理特性

#### 智能检测
- 自动检测端口占用情况（8001、5005、3000）
- 识别运行中的服务进程
- 智能决定启动或重启策略

#### 优雅停止顺序
1. 前端服务 (3000) → 用户界面
2. Rasa服务 (5005) → AI模型服务  
3. 后端服务 (8001) → API服务

#### 智能启动顺序
1. 后端服务 (8001) → API服务优先
2. Rasa服务 (5005) → AI模型服务
3. 前端服务 (3000) → 用户界面最后

### 停止所有服务
```bash
# 一键停止
stop_all_services.bat

# 或使用scripts目录
scripts\stop_all_services.bat
```

## 🔗 服务访问地址

启动完成后，可通过以下地址访问各服务：

| 服务 | 地址 | 说明 |
|-----|------|------|
| **前端界面** | http://localhost:3000 | 主要操作界面 |
| **后端API** | http://localhost:8001 | API服务端点 |
| **API文档** | http://localhost:8001/docs | 交互式API文档（支持国内CDN） |
| **ReDoc文档** | http://localhost:8001/redoc | 详细API文档 |
| **Rasa API** | http://localhost:5005 | RASA模型服务 |

## ⚙️ 环境要求

### 系统要求
- **操作系统**: Windows 10/11, macOS, Linux
- **Python**: 3.8+ (推荐 3.9)
- **Node.js**: 14+ (推荐 16+)
- **内存**: 最低 8GB，推荐 16GB+
- **磁盘**: 至少 10GB 可用空间

### Python环境配置
```bash
# 检查Python版本
python --version

# 创建虚拟环境
cd backend
python -m venv venv

# 激活虚拟环境 (Windows)
venv\Scripts\activate

# 激活虚拟环境 (macOS/Linux)
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt
```

### Node.js环境配置
```bash
# 检查Node.js版本
node --version
npm --version

# 安装前端依赖
cd frontend
npm install
```

## 📊 核心功能使用

### 1. 指令库管理
- **创建指令库**: 支持多业务场景
- **业务编码**: 唯一标识不同业务
- **语种支持**: 中文、英文等多语种
- **状态管理**: 启用/禁用状态控制

### 2. 双屏数据处理 ✨ 新功能

#### 支持的Excel格式
**指令文件格式**:
```
指令标识 | 指令名称 | 分类 | 相似问 | 指令描述 | 关联词槽 | 执行成功话术 | 执行失败话术 | 追问话术 | 追问失败话术 | 追问次数
```

**词槽文件格式**:
```
词槽名称 | 词槽描述 | 实体标准名 | 实体别名
```

#### 使用方法
1. **API接口方式**:
```bash
POST /api/v2/dual-screen/upload-and-process
# 上传指令文件和词槽文件
```

2. **Python代码方式**:
```python
from backend.services.dual_screen_processor import process_dual_screen_files

result = process_dual_screen_files(
    "instruction.xlsx", 
    "slot.xlsx", 
    "output_dir"
)
```

#### 追问逻辑支持
- **智能词槽检测**: 自动识别必需词槽
- **表单自动生成**: 为词槽填充生成RASA表单
- **追问次数控制**: 可配置最大追问次数
- **话术定制**: 支持个性化追问和失败话术

### 3. 模型训练
- **异步训练**: 后台训练不阻塞界面
- **进度监控**: 实时查看训练状态
- **版本管理**: 自动生成版本号
- **配置定制**: 支持自定义训练参数

### 4. 指令测试
- **单条测试**: 快速验证单个指令
- **批量测试**: Excel批量测试支持
- **准确率分析**: 详细的测试结果分析
- **历史记录**: 测试历史追踪

### 5. 系统监控 ✨ 真实数据
- **CPU使用率**: 真实系统CPU监控
- **内存使用**: 实际内存占用情况
- **磁盘使用**: 主磁盘使用率
- **网络状态**: 网络活跃度监控

## 🛠️ 高级配置

### CDN配置优化
平台已优化API文档CDN配置，无需VPN即可访问：
```bash
# 查看当前CDN配置
python backend/manage_cdn.py

# 测试CDN速度
python backend/manage_cdn.py --test

# 切换CDN
python backend/manage_cdn.py --switch
```

### 启动顺序详解
脚本会在**单个窗口**中按以下顺序启动服务：

1. **Rasa服务** (端口: 5005) - 优先启动
   - 使用GPU加速训练
   - 等待时间: 15秒（首次运行可能更长）
   - 后台运行

2. **后端服务** (端口: 8001)
   - 激活虚拟环境: `backend/venv`
   - 等待时间: 8秒
   - 后台运行

3. **前端服务** (端口: 3000)
   - 使用React开发服务器
   - 等待时间: 10秒
   - 后台运行

## 🔧 故障排除

### 常见问题解决

#### 1. 启动失败

**优先使用智能重启** ✨：
```bash
# 推荐：一键智能重启（会自动处理服务冲突）
scripts\restart_all_services.bat
```

**手动诊断**：
```bash
# 检查环境
python --version
node --version

# 检查端口占用
netstat -ano | findstr :3000
netstat -ano | findstr :8001
netstat -ano | findstr :5005

# 强制停止服务（不推荐，除非智能重启失败）
taskkill /F /IM node.exe
taskkill /F /IM python.exe
```

#### 2. 依赖问题
```bash
# 重新安装Python依赖
cd backend
pip install --upgrade -r requirements.txt

# 重新安装Node.js依赖
cd frontend
rm -rf node_modules
npm install
```

#### 3. 双屏数据处理问题
- **文件格式**: 确保Excel格式正确
- **列名**: 检查列名是否与要求一致
- **编码**: 确保文件为UTF-8编码
- **数据完整性**: 检查必需字段是否填写完整

#### 4. 追问逻辑问题
- **词槽映射**: 确保词槽名称一致
- **实体值**: 检查实体标准名格式
- **追问次数**: 验证追问次数配置

### 手动启动服务（调试用）

如果自动启动失败，可以手动逐个启动服务：

1. **启动后端**
   ```bash
   cd backend
   venv\Scripts\activate
   python app.py
   ```

2. **启动Rasa**
   ```bash
   python start_rasa_gpu.py
   ```

3. **启动前端**
   ```bash
   cd frontend
   npm start
   ```

## 📁 项目结构

```
instruction_training_platform/
├── backend/                    # 后端服务
│   ├── api/                   # API接口
│   │   ├── dual_screen_import.py  # 双屏数据导入API ✨
│   │   ├── instruction_data.py    # 指令数据API
│   │   ├── model_training.py      # 模型训练API
│   │   └── ...
│   ├── services/              # 服务层
│   │   ├── dual_screen_processor.py  # 双屏数据处理器 ✨
│   │   ├── rasa_service.py           # RASA服务
│   │   └── ...
│   ├── models/                # 数据模型
│   ├── app.py                 # 主应用
│   └── requirements.txt       # Python依赖
├── frontend/                  # 前端服务
│   ├── src/                   # 源代码
│   │   ├── pages-v2/         # 页面组件
│   │   ├── components/       # 通用组件
│   │   └── ...
│   ├── package.json          # Node.js依赖
│   └── ...
├── rasa/                     # RASA配置
│   ├── data/                 # 训练数据
│   ├── models/               # 训练模型
│   ├── config.yml            # RASA配置
│   └── ...
├── scripts/                  # 启动脚本
│   ├── start_all_services.bat    # 一键启动
│   ├── stop_all_services.bat     # 一键停止
│   └── ...
├── docs/                     # 文档
│   ├── 双屏数据处理使用指南.md     # 双屏功能文档 ✨
│   ├── 追问逻辑实现详解.md         # 追问逻辑文档 ✨
│   └── ...
└── public/                   # 测试数据
    ├── 402/                  # 双屏测试数据
    └── ...
```

## 🎯 最佳实践

### 1. 开发流程
1. **数据准备**: 使用双屏Excel格式准备训练数据
2. **数据导入**: 通过API或界面导入数据
3. **模型训练**: 配置参数并启动训练
4. **测试验证**: 批量测试验证模型效果
5. **版本管理**: 比较版本并激活最佳模型

### 2. 性能优化
- **分批处理**: 大量数据分批导入
- **定期清理**: 清理无用的训练记录
- **版本控制**: 及时删除过期版本
- **监控检查**: 定期检查系统资源使用

### 3. 开发模式
- **热重载**: 前端支持热重载，修改代码后自动刷新
- **调试**: 后端使用uvicorn的reload模式
- **文档**: 使用API文档进行接口测试

## 🔄 版本更新

### v2.0.0 最新功能 ✨
- **双屏数据处理**: 完整支持双屏Excel数据格式
- **追问逻辑**: 智能词槽填充和追问机制
- **真实系统监控**: 使用真实数据替换模拟数据
- **CDN优化**: 国内CDN支持，无需VPN访问文档
- **API完善**: 新增38个API端点
- **性能优化**: 启动速度和运行效率提升

### 升级说明
1. **新用户**: 直接使用最新版本
2. **现有用户**: 更新依赖后重新启动服务
3. **数据迁移**: 旧格式数据可通过转换工具迁移

## 📞 技术支持

### 获取帮助
1. **文档查阅**: 查看详细技术文档
2. **API测试**: 使用 http://localhost:8001/docs 测试API
3. **日志分析**: 查看 `backend/logs/` 和 `rasa/logs/` 日志
4. **问题反馈**: 通过平台内置的问题反馈功能

### 常用命令
```bash
# 查看服务状态
curl http://localhost:8001/api/health
curl http://localhost:5005/status

# 重启单个服务
python backend/app.py
python scripts/start_rasa_simple.py
npm start --prefix frontend

# 查看日志
tail -f backend/logs/system.log
tail -f rasa/logs/system.log
```

### 生产部署建议
- **后端**: 使用Gunicorn + Nginx
- **前端**: 构建静态文件部署到Nginx
- **Rasa**: 使用Docker容器部署
- **数据库**: 使用PostgreSQL替代SQLite

---

## 📝 总结

智能对话训练平台v2.0已经成为一个功能完备的对话AI训练和管理平台，特别是新增的双屏数据处理和追问逻辑功能，大大提升了平台的实用性和智能化水平。

**平台现在支持**：
- ✅ 完整的指令库生命周期管理
- ✅ 双屏Excel数据快速导入和处理
- ✅ 智能追问逻辑和词槽填充
- ✅ 异步模型训练和版本管理
- ✅ 批量测试和准确率分析
- ✅ 真实系统性能监控
- ✅ 国内CDN优化的API文档

🎯 **立即开始**: 双击 `start_all_services.bat` 即可体验所有功能！

---

*最后更新时间: 2025-07-01*  
*平台版本: v2.0.0* 
