# Rasa智能家居指令识别准确性优化方案

## 📊 测试结果概况

基于2022年6月22日进行的两次批量测试分析：

- **测试数据量**: 310条智能家居指令
- **第1次测试** (阈值0.80): 成功识别 259/310 (83.5%)
- **第2次测试** (阈值0.85): 成功识别 248/310 (80.0%)
- **识别失败案例**: 62条独特失败案例

## 🔍 主要问题分析

### 1. 🔧 系统设置类问题 (12条失败案例)
**问题描述**: 缺少系统设置相关意图  
**典型失败案例**:
- "打开设置" (49.55%)
- "进入设置" (59.27%)
- "打开设置页" (56.09%)

### 2. 🌐 网络连接类问题 (9条失败案例)
**问题描述**: 缺少网络操作相关意图  
**典型失败案例**:
- "我想联网" (51.20%)
- "打开网络设置" (61.34%)
- "连接网络" (24.84%)

### 3. 🌡️ 数值型设置问题 (11条失败案例)
**问题描述**: 温度、亮度等数值型设置识别不准确  
**典型失败案例**:
- "设置亮度为八十" (75.85%)
- "温度设置为50" (49.04%)
- "加热到180度" (44.51%)

### 4. 🍳 具体食物制作问题 (4条失败案例)
**问题描述**: 缺少具体食物制作意图  
**典型失败案例**:
- "我想做鸡肉" (37.91%)
- "我想烤蛋挞" (63.32%)

### 5. 🔄 意图混淆问题
**主要混淆类型**:
- 温度设置被误识别为亮度调节 (bright_value)
- 查看类指令被错误映射到分类设置 (set_category_size)
- 火力设置被误识别为温度设置

## 🎯 优化方案

### 阶段一：高优先级修复 (立即执行)

#### 1.1 新增系统设置意图
```yaml
# 在 domain.yml 中添加
intents:
- open_settings
- system_config

# 在 nlu.yml 中添加训练数据
- intent: open_settings
  examples: |
    - 打开设置
    - 进入设置
    - 设置页面
    - 打开设置页
    - 进入设置页
    - 设置菜单
    - 系统设置
    - 打开系统设置
    - 进入系统配置
    - 设置界面
```

#### 1.2 新增网络连接意图
```yaml
- intent: connect_wifi
  examples: |
    - 连接WiFi
    - 联网
    - 连接网络
    - 我想联网
    - 帮我联网
    - 网络连接
    - WiFi连接
    - 无线连接

- intent: network_settings
  examples: |
    - 网络设置
    - WiFi设置
    - 打开网络设置
    - 打开WiFi设置
    - 查看网络
    - 网络配置
    - 无线设置
```

#### 1.3 优化现有意图训练数据

**扩充 bright_value 意图**:
```yaml
- intent: bright_value
  examples: |
    # 现有样本...
    # 新增数值型样本
    - 设置亮度为[八十](亮度值)
    - 亮度设为[百分之六十](亮度值)
    - 亮度调到[50](亮度值)
    - 屏幕亮度设为[30%](亮度值)
    - 调节亮度到[70](亮度值)
```

**扩充 set_cooking_temp 意图**:
```yaml
- intent: set_cooking_temp
  examples: |
    # 现有样本...
    # 新增具体温度设置
    - 温度设置为[50](温度值)度
    - 设置[100](温度值)度
    - 加热到[180](温度值)度
    - 温度调到[80](温度值)
    - 加热至[30](温度值)度
```

### 阶段二：中优先级修复 (1-2周内)

#### 2.1 增加具体食物制作意图
```yaml
- intent: cook_specific_food
  examples: |
    - 我想做[鸡肉](食物名称)
    - 我想做[大虾](食物名称)
    - 我想做[猪肉](食物名称)
    - 我想烤[蛋挞](食物名称)
    - 煎一个[鸡蛋](食物名称)
    - 做[牛排](食物名称)
    - 烹饪[排骨](食物名称)
```

#### 2.2 扩充实体定义
```yaml
# 在 domain.yml 中添加实体
entities:
- 温度值
- 亮度值
- 食物名称

# 添加对应的slots
slots:
  温度值:
    type: text
    mappings:
    - type: from_entity
      entity: 温度值
      
  亮度值:
    type: text
    mappings:
    - type: from_entity
      entity: 亮度值
```

#### 2.3 修复意图混淆问题

**优化训练数据区分**:
```yaml
# 明确区分温度和亮度设置
- intent: set_cooking_temp
  examples: |
    - 加热到[30](温度值)度
    - 烹饪温度[50](温度值)
    - 热一下到[60](温度值)度

- intent: bright_value
  examples: |
    - 屏幕亮度[30](亮度值)
    - 亮度调到[50](亮度值)
    - 显示亮度[80](亮度值)
```

### 阶段三：配置优化 (2-3周内)

#### 3.1 调整置信度阈值
```python
# 在批量测试配置中调整
CONFIDENCE_THRESHOLD = 0.77  # 从0.80/0.85调整到0.77
```

**调整依据**:
- 17条失败案例置信度在0.75-0.85之间
- 降低到0.77可以提升约5.5%的识别率
- 在准确率和召回率之间取得平衡

#### 3.2 增加意图澄清机制
```python
# 在rasa_service.py中添加置信度检查
def handle_low_confidence(intent, confidence, text):
    if 0.65 <= confidence < 0.77:
        return {
            "intent": intent,
            "confidence": confidence,
            "clarification_needed": True,
            "message": f"您是想要'{intent}'吗？我的理解准确度为{confidence:.1%}"
        }
    return None
```

#### 3.3 优化实体识别
```yaml
# 修复菜品名称实体边界识别
- intent: remaining_cooking_time_query
  examples: |
    - [红烧肉](菜品名称)可以吃了吗
    - [鸡翅](菜品名称)烤好了吗
    # 而不是识别为 "红烧肉可以"
```

## 📈 预期效果

### 短期效果 (1周内完成阶段一)
- **识别成功率**: 从83.5%提升到**90%+**
- **系统设置类**: 识别成功率从0%提升到**85%+**
- **网络连接类**: 识别成功率从0%提升到**80%+**

### 中期效果 (2-3周内完成所有阶段)
- **整体识别成功率**: 达到**93%+**
- **边界案例识别**: 改善置信度0.75-0.85区间的识别
- **意图混淆**: 减少90%的混淆问题

## 🛠️ 实施步骤

### 第1步: 数据准备 (1天)
1. 备份现有的`nlu.yml`和`domain.yml`文件
2. 准备新增意图的训练数据
3. 更新实体定义

### 第2步: 模型训练 (1天)
1. 更新训练数据文件
2. 重新训练Rasa模型
3. 验证模型基本功能

### 第3步: 测试验证 (1天)
1. 使用失败案例进行单独测试
2. 运行完整批量测试
3. 对比前后效果

### 第4步: 配置优化 (1天)
1. 调整置信度阈值
2. 更新后端服务配置
3. 部署新版本

### 第5步: 效果评估 (1天)
1. 进行新的批量测试
2. 分析改进效果
3. 记录优化结果

## 📋 检查清单

- [ ] 备份现有配置文件
- [ ] 添加open_settings意图及训练数据
- [ ] 添加connect_wifi和network_settings意图
- [ ] 扩充bright_value和set_cooking_temp训练数据
- [ ] 添加cook_specific_food意图
- [ ] 更新实体定义
- [ ] 重新训练模型
- [ ] 调整置信度阈值到0.77
- [ ] 进行测试验证
- [ ] 部署优化版本

## 📞 后续监控

1. **周期性测试**: 每月进行一次批量测试
2. **新场景收集**: 收集用户反馈的识别失败案例
3. **持续优化**: 根据新数据持续改进模型
4. **性能监控**: 监控响应时间和识别准确率

---

**编制时间**: 2024年12月22日  
**预计完成时间**: 2024年12月29日  
**负责人**: AI训练团队 