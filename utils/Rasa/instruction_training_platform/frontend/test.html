<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PCM音频播放器</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #fff;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        h1 {
            text-align: center;
            margin-bottom: 25px;
            font-size: 2.2rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            color: #fff;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 25px 0;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 25px;
            background: linear-gradient(to right, #4a00e0, #8e2de2);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(to right, #8e2de2, #4a00e0);
        }

        button:active {
            transform: translateY(1px);
        }

        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .audio-info {
            margin: 25px 0;
            padding: 20px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .audio-info p {
            margin: 8px 0;
        }

        .audio-info strong {
            color: #8be8b0;
        }

        .status {
            margin-top: 20px;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .success {
            background-color: rgba(40, 167, 69, 0.2);
            color: #28a745;
            border: 1px solid #28a745;
        }

        .error {
            background-color: rgba(220, 53, 69, 0.2);
            color: #dc3545;
            border: 1px solid #dc3545;
        }

        .processing {
            background-color: rgba(0, 123, 255, 0.2);
            color: #007bff;
            border: 1px solid #007bff;
        }

        .player-controls {
            margin-top: 25px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .progress-container {
            width: 100%;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            height: 10px;
            margin: 10px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, #8e2de2, #4a00e0);
            width: 0%;
            transition: width 0.1s linear;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #ddd;
        }

        .volume-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .volume-control input {
            flex-grow: 1;
        }

        .event-log {
            margin-top: 25px;
            max-height: 200px;
            overflow-y: auto;
            padding: 15px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.85rem;
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .debug-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .debug-title h3 {
            margin: 0;
        }

        .clear-btn {
            padding: 5px 10px;
            font-size: 0.8rem;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>PCM音频播放器</h1>
    <div class="controls">
        <button id="decodeBtn">解码并播放音频</button>
        <button id="stopBtn" disabled>停止播放</button>
    </div>

    <div class="audio-info">
        <p><strong>音频信息：</strong></p>
        <p>• 时长：4.176秒</p>
        <p>• 采样率：16000 Hz</p>
        <p>• 声道数：1 (单声道)</p>
        <p>• 位深度：16位</p>
        <p>• 格式：原始PCM (转换为WAV播放)</p>
    </div>

    <div id="status" class="status"></div>

    <div class="player-controls">
        <div class="progress-container">
            <div id="progressBar" class="progress-bar"></div>
        </div>
        <div class="time-display">
            <span id="currentTime">0:00</span>
            <span id="durationTime">0:00</span>
        </div>

        <div class="volume-control">
            <span>音量:</span>
            <input type="range" id="volumeControl" min="0" max="1" step="0.01" value="0.7">
            <span id="volumeValue">70%</span>
        </div>
    </div>

    <div class="debug-section">
        <div class="debug-title">
            <h3>事件日志</h3>
            <button id="clearLogBtn" class="clear-btn">清空日志</button>
        </div>
        <div id="eventLog" class="event-log"></div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const decodeBtn = document.getElementById('decodeBtn');
        const stopBtn = document.getElementById('stopBtn');
        const statusDiv = document.getElementById('status');
        const progressBar = document.getElementById('progressBar');
        const currentTimeEl = document.getElementById('currentTime');
        const durationTimeEl = document.getElementById('durationTime');
        const volumeControl = document.getElementById('volumeControl');
        const volumeValue = document.getElementById('volumeValue');
        const eventLog = document.getElementById('eventLog');
        const clearLogBtn = document.getElementById('clearLogBtn');

        let audioContext = null;
        let audioBuffer = null;
        let audioSource = null;
        let isPlaying = false;

        // 添加日志函数
        function addLog(message) {
            const now = new Date();
            const timeString = now.toTimeString().split(' ')[0] + '.' + now.getMilliseconds().toString().padStart(3, '0');
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.textContent = `[${timeString}] ${message}`;
            eventLog.appendChild(logEntry);
            eventLog.scrollTop = eventLog.scrollHeight;
        }

        // 清空日志
        clearLogBtn.addEventListener('click', () => {
            eventLog.innerHTML = '';
        });

        // 更新状态显示
        function updateStatus(message, type) {
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
        }

        // 格式时间显示 (秒 -> mm:ss)
        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${min}:${sec < 10 ? '0' : ''}${sec}`;
        }

        // 从Base64字符串解码为二进制数据
        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        // 将PCM数据转换为WAV格式
        function encodeWAV(pcmData, sampleRate = 16000, numChannels = 1, bytesPerSample = 2) {
            const buffer = new ArrayBuffer(44 + pcmData.byteLength);
            const view = new DataView(buffer);

            // RIFF标识符
            writeString(view, 0, 'RIFF');
            // RIFF长度 = 文件总长度 - 8
            view.setUint32(4, 36 + pcmData.byteLength, true);
            // WAVE标识符
            writeString(view, 8, 'WAVE');
            // fmt块标识符
            writeString(view, 12, 'fmt ');
            // fmt块长度
            view.setUint32(16, 16, true);
            // 音频格式 (1 = PCM)
            view.setUint16(20, 1, true);
            // 声道数
            view.setUint16(22, numChannels, true);
            // 采样率
            view.setUint32(24, sampleRate, true);
            // 字节率 (采样率 * 声道数 * 字节/样本)
            view.setUint32(28, sampleRate * numChannels * bytesPerSample, true);
            // 块对齐 (声道数 * 字节/样本)
            view.setUint16(32, numChannels * bytesPerSample, true);
            // 位深度 (字节/样本 * 8)
            view.setUint16(34, bytesPerSample * 8, true);
            // data块标识符
            writeString(view, 36, 'data');
            // data块长度
            view.setUint32(40, pcmData.byteLength, true);

            // 复制PCM数据
            const data = new Uint8Array(buffer, 44);
            const pcmBytes = new Uint8Array(pcmData);
            for (let i = 0; i < pcmBytes.length; i++) {
                data[i] = pcmBytes[i];
            }

            return buffer;
        }

        // 辅助函数：写入字符串到DataView
        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }

        // 解码并播放音频
        decodeBtn.addEventListener('click', async () => {
            try {
                updateStatus("正在解码音频...", "processing");
                addLog("开始解码音频数据");

                // 1. 从JSON中提取PCM字段 (Base64编码)
                const jsonData = {
                    "tracks": [
                        {
                            "audio": [
                                {
                                    "pcm": "//NoxAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//NoxAAOoAaJv0AQAtCo1bbNtt+LLPrcpyU8oD+fDIqfVbJs7D853fL0o/xB8pI///729vX9QYKXDRwnIB4gHyaj4P6nf9SVCEIqDAYDoUiUkbymWTrMZRkMEiNfAJHhhcGmbxGZCOxqc/GUPEdxI4QBDB4DB10BxzFBudfYTbQC9506yWCwzgWN+qDLDk5dLqU+V44tdAyfF0NGMDK0dcsGKhd+nx75fBWBlbH7KQaEDzQ5a7r/3u9Txui3L5NGc5XDljf9/fe87n+ue+8jtUvcJzL+4/j///NoxJBFFBZeX5zYAOW94/+8ucy/PO3XqXf/u////8/1jSNbc9xIm1t+1cQmjZZelDI1oLBvhJqKNQJTw7j/cOfvL////3hamHC6eikIf5DDlsvn5S5bjq4kQiBkzqrmymklsdi9eH4619zec//w///P/////3r//+f///4c7rDWsHftWblJZzv65rWv1rm8qNUAtdqgtc8s7uFAxIlVEpcu0r6XdlrcRQYbbaLJEvWxx2JxBVoUWKTlk8QQwFBg2GBsyIVFKlAlyMD2QMudAo8AzrcDLHgF//NoxEY+xBaUX9qgAMaAcJAOJh3gMovA9skCiIAoiBlTYASMZENYBpoAG4UAZQgAoQLhVDL4WwGuMmQAxSUYlAPnPkeRMyPIDGCdCkXzNNz5ABmCqVG1FxjDWgpEi6ROLWbmYy4ucrkUYvkAIqbmBZJdEvvZRACZU6qaaan/29da01pGDF84ulMy+lU1lv636F1ugitIuGg7CbGUJwokDFxlchCCEweJgiBDyDk2Vy+kaMrUzft/f910EWZRgaHlHTeEslBOF2tuSXqa79SpDAwBSaBkYmf+//NoxBYvi2bKX1iQAjggQnm48toZqtUbmzXn1JGQp4qJoXzphOCJkUGUHscIuYXRNh6pPOip80IsfD4RcJETxdDIANtRKRHl02LIWVgLUGxkXNSYNDAX4ZeHSVUnUggLPHle6BwplWbL1GLfmr26yUIkZW3l1BTU3Wy6kGTdl/U/6lmLuqgmgeM7OpGkddjczIATZsaGZkbzhy6BuYpFMqo0jqB8vGK0FlQ+ibJPFlGv/7jjySrEgEGBIA5y2ORCMFhpgKdUBI/GiwSnOkg8enBlwBADEA4V//NoxCI163Z1H5uYAA9hhucEYuEJusFaSB10AgIDGQb8SZCBjomJVDVgfuI1GeFDDNFI+N8iw2i0R4yKSReNkWorNEFpkOIsOIAVQKDAyPqWs0TN6b4wg2EdJOCCxA0kWSdskD5obIm5PkWdZeIEpRmZI6O61IS0bE4RBctplIhpaLxkRZIvOyWpSLrf0SfNzI0JBNBJE3K6SS0C8oydZRIKOSWlr//6E8kaGmfveyjtRepLMnRl0urIqeMkzX//mLzd5QwRUajkShETicSiVjta4GJXqjQx//NoxBUyC3bFv494Ahws6oYkoYY/x7iZR3+FRPMpgSJjmWc6Fi5xG9WqDRj3RamenCZace6jeVnbTWfIpXOoCqLhFvf6wyR8xI7ctgCcS7IuxN1puf3zT1/YK/X6lQt+wMaEoW8Vm8/Hx//WbV86t0XGPOY61CzOEyvgMVsZrLrWv9/FPAYXJwpjeorizv5Iay5xMN7mr73if/Fv/j1pv/5xnH9dSbm19PNPM7ZKx75furMkJDFA5MmlfLEh7bv0KqAwE7gAIKf7h3LOqz1AkTZlnXhjNK+q//NoxBcpGyamP9loAaqEipBz9NG6spYCh2ga/58uj6CmglC4m1joLaOYmII50YUyLjNWVDJPmTbqNnUrmRaaG1kh3CNEdSJfRNjIhD1EzOGipkmaLf3NFugm6nre7rejV0abqd1ougx2tv/9S6mQXSNEUlqUa3uySlovSdJ0Vq3V1tRMnm5CIgoKLO//+/80kMgR3lvKUrwQiNXIMBmW5AIpXWOc/6eCyqRA5lssu/nGC/yl0ixpbmW60utZY85lVwXTzDgpGO/9lq+zKybqz//u+bDZ3x49//NoxD00bBayXsGfHONjIIL6qwgJA1y3ZD9pT+Q7uhzM2NiGcmngOnSAWmUEILKDFHIEN8RAiQKZfz5neavbW3jhTSvVD98yUw81fWt0iZf39NeHHxT+BXfxAeUpGlfv38fB+IQr3OIwKBOJxUPH7mu2lrnJ+S9zNxANSTIWaaFlAcIKghDIcjin1tQMBBxNyDi5iFknUhoRUWj7ZblBEhsaiUbktsRAAZA7Jm5JJpKGIlbXmrNfC70/07WGtmPavkb77js16rsDnZo5/n9/Iiq0S3+WWBGm//NoxDYnpBa+XGDfXnlrgvtu38y97wyWNyxUqBSiKTNWUZWNl3pcY/LdFY786xlSX78//vM7MvOl2+M7j6eZb/G1JIwsifhssG71zcVMyJidemOtnRy5VBtvTVTykKKpUxlahcY6jIRalip+Ixwd4VbtWxYEKtm5Zbdo0qQBmvNG3aM4AMaAAamZmfHAkLhEIYfgINKQv4DkxA0HMhEIPToYfUnlnMRTUixx4gkn+8azbzXXPam5dPHQB/pelMgvPlt/+25fn311hUepo56hMpI1KSsW/a+m//NoxGIisorSXEsMbqPvtfyvnmONZW7qnosHiQmr6NA7Iof1pK6F5YNA6C0GQGEzIqKgkK42Z2d4iomPAXNH53cb24gvhDItqaGzGdBIEBxYBbsg8pcsswMOHhMzJDMEvD6ExaKAlcLtOzIIeBIAVDUwUUDAhgaxXhdWGoabC0xAGWk3LYclwqaUWIgAMH2JqOa4B8R4uL/lXvmLaLEEOD5WpXa4vj+G5GDTVpVa1jp6O3o/cBMGwwV3/2DFNdZnbo6krO2VvUhKqzLlM+mqZlVDW/UrI5TB//NoxKIq84qzHNoFUZpL11v6i67zejZMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqnAaMHZiGAC0YkAkZFiJIZflvp3XO47uUIwdJ0s/+X///EUMS6DHLNTlam176omyLWX/FIPiP6HjoECpk3sKRacb1Y6g2JN//o6oSHh12/G3//+hxx/9jjnb+pF2+g6Gn0LBUVRxj1PWGk//X6bwCKiohKjZMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqYFABiLeRVtX99qySlXbGoPMY//NoxKgc8raiXh6OXEs2yACFB17F+x27eh8ADI8iSTLDP/7jKnrLWqByPHLeONl0m/SFTNkFjP6LCpxESm/79KikUxFMu17qXpE2xL//6yIjTRIox8vyiEcAEfsCFVDIOef1SOnP/WbpcGjShRjAHBhjqlToy7EwMuGoYZuUT5/X44kMTbdz5qvuswZNyrl9X4v7SrbnaiggZBgQwCkDMKVqOkpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqoIXQTLKD4nGmJQbDBgYgGn//NoxN0qI+51vtpHTR+HFJyZkAqUbzu/Ddd9FyFnAIAzGIsDhPT2pPp48TiGGQO8P4m22WJ9P39i+ALxt2vDv/8WbDqhYvm9KZjwlbr7xn/V94jYxT/N8SvWJ3Bj3gPImHkHcH/eafN/6Y/zv496Q97//z8VpBpS0fOIcDblIh20h8ON9QiDuZmUzRcIjWrUASVwBjEKXYoGix7DSgoVEbBZFdUAACwph0MiAQDISBwaCs9GMQcJ6SCgbYqYdA5jLFYgSYEQIHF12IAQ5Gh2Bx5+lkSRvmmg//NoxNspil5cDVx4ANDreruVfmEH5EhAXDMWFQDKQLQ9ZzzLGT3lNFyLUEgSFIdNMuGNMOmK1Bc3mkWzeWGGAFtEcB4wYI4AD51GJ+Q50HHeYav/MmRCpFqXrkSIeRMMKADWjTQJBAEMSXLiNSUxXTFs7lmre2rtt1SJCLUXe48+ywmFAYArQ2yfJWCUKeRguPf/8qav3WttYaZdh/sRXfI3YYY0yG2lTq5X/fd/2iQM4enxaf+X///////j7X37VxLJY19+7a6KLsj5Txu6teW2W3XwgMXO//NoxP9QDBZuX5rQAJ0TLtNu2j5RL8v/nP1j//////h8Nz8uaxFHLYe67sM4ijX3/l8sjE5b71p7hLXeGIs4Ze7U1JpNDl+MSqkzlsvvKtG7bZigo227Jbj/d/XfuUtIVQsaYCphUVCQmMAAseAhgMCMMRSYmiKSAgy4/DhQFNFgowsDxVh6I8juF+XQUPAZwoBrV4GnghRYAoaC4FvybGTNbrXSSdZPv0nV7IGSSSX1KJ4yLz69jRFSkkfqOMv/1Lb+t6+6aalEwRQ8yTPTUtdNI0rukvOl//NoxIktU5LOX9ygAvMjxky2ZkC4Tiz7nTI1osixE0kT552W7LUTaU4xtWqk83SVXdBE31GBjut6arpFMUFpJGk65Xi7yurRc96PoPG9bruCzPUOkGEIBvX9L5/4JENPH/39ZvguwR4J1usyR0+8bFewguE68/j73a2ygBw2If8iG1f8iC+b/jIdE+v6jEYD/1CkO8yu6VUQRHpbmsj/ggxxV+sxhQKOfhodVkgI6V2vJRyyFInoC3iz6kxBTUWUgGAIkQKnhyQbyrz/KmUlYQRLMUr3Puf9//NoxJ4gEs7WXnqFiloHxKoIYwekQnewlcL/CncCOmOKp0NUa4OPLC4ZiVeHKexTNyfNdkU3rL5RSyeiegVB2BN5U5zmrvJAFCg4T+UESDNdX97WpF3wr//2qVKM7Xz5NKUkTLc5//9JE9SGRhB6qHoQRERc239rVELKFaKPcqcU3hUCRUTEju2w1KVzPG4OY9Ki6Prv8momUDiNnSihwN7M4fVMQU1FMy4xMDBVVVVVVVVVVVVVVVWVo2AiJZNbxTNPqPO5lajeNdVASjls811y1BKt6vKs//NoxOQr2vKWHNlTgWPCEIFTtvXzs9/uMulQoCdVYObn5RIbUpuXJT2Os+ayyepu1vPlQ8EkEUmQz/PwzD0Cobqp138sG4EYyP09rfhMBUHQeh+lT/0HQLjzBez+v7mGtE+OuNRQUEOemolWKH7m6z3D5KF4tIjEiiiAC4IwgEcGisYPH0OQW8q1tv8csXay+1m0W3mqefvSQKFCKLPpESPTP2pMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqNDUIYRiLs6/Lf63z//NoxOotW66uPMrRa1fsPwmkhiVA0nhpwdIbj3nbndWnlTZet0bNrHKU0UqepdyDCeYnHBE260YGbSDS5Ml4blTuukJlwoYnqNtNtKkAMn/PJ9JLcYQD51en1ZFKocVLxp0+o4CE//GtSSl9LfVHHPjuYsZVFFIgPiJYyoGK1yo0gR6tGZVS9a67/4+Zv571IvKw+phYasDxCPTiaD2csosY7VW6oWhqVX1puw8fNVLGumTBVnibMvXV7SFT7dv+bVqjTSJG7f/WYnRMncSO1P/6/ZjJa5+n//NoxNcoi4a2/MJRL4If1a8UaUzRFd5qJ3Hrb9OQtojhiQGOAnKabE0M1zK85AaY6cB1thkOmNdOCnJYoG9Vpwgigb0fVIPNe98RL3/pqG/fzP4/xAea1ums/Gs6x8///01n7vfPz////T5/+P859KYgU/ve993fx6Uph48pSn/zh48Vk2Ver1ez7hoWb4SAuBfB6EJHrR+2NDHrmbhkKwvhLHCVXwmRvUcdCliDiIaXikZlJUz//toZyVZbGQzqBGuZRO07SQgPBqLUc5YTDnEqp3NQ8Trt//NoxP80nA7SXk4fhtnhv91v2dizm8W3KOEo0loNIhR+ACkUgch9gnhwECoyhgnWLgd6ngMC4d6SLQfh/rKMckA9yrFBhftq6zuGsuDG/tpxnw4skWFAcoetsUSt40+3kOSLFtmNS940PWt/ESlfrcLNdbxqsJzeZ+qv3jnM5QnsSJeFHfsyyiGCBFcC+PmWygTrUrVaztyrII9QByl/RSGsirHgYQpIeTkEcbw6RgGOzOhGRmF1IMICL0WNciFqVuQs4zDbB+DLTdVMQU1FMy4xMDBVVVVV//NoxPc6TBazHkmevFVVVVVVVVVVVVVVVVVVu1viHdq0TwEd9dZCy9hGpbxYVkZAGFR8Nokm1mF19bZ65RKhWLd3BgwqExk5AwaH9pHT2Ch5z6ggMKxhgFSQcg6uJTE9/P+D+sUL0jpDuuyC3khUuwIdxML1PjztPOUif30I50zhfOH8V9s7BMCcK8b2z7zaU4x/SNSCgq2XEq0oChGGqdoxFxZMQU1FMy4xMDBVVVVVVVVEaJmIh1jQN2tjre0e1gmOmAIBwBQtTD6R+OyyBAxNTkzFEI2M//NoxL0iQ9rKejpGP17HDMRwXIwpRCTS2wQmBAsIFmQJDII6VIyvM15wm/GoDGLThdAAAZkQzyLXEQo0olR5SDir6nhFMUIIXvjPufy9POORCStbsv/Ks5nns+YdmzVNWXm78dj865s4lzl5veZxtqqftNW2Ul275mfts84V4U2b/SVdB2JIJFe8bzH7//+Kiu8K8mSeNyCm0S0LoKSl838v87hMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqojOHS1SWsAR+////NoxPAu+ma3GPaMr/1mjNQnjAZBwMOVLU4OWGj0DtNCnwwWGYlH4YqROasqnHBoYnCBep0d87/+0gqgUQgRFF3ecvjIDoEQbBEUH3N54NyiRgKg+lvlxgr+zrxeOi1///mmlVZtf1GGlHca2lOaUciTETDwcSOkiHSmX7ogdLpdfjruJvnr+e///ra+//iq3v/tMUHVIxwiXC5DqUxoZSBySaJMQU1FMy4xMDCqqqqqqqqqqqrGp7Yx3f/jNSl+Y06QUKzphAeFW+q38c89PzDQiE2m/d/p//NoxNUoM0qm/PcQdpw2CGEfHaOpkkgyYHBES2YE2dOmpqXBaxVDI6lLLlaYWBHyTVTqTNZsIQjhQSUrasZ0ky/7nXSUm6vvl251jJOPiwIwwHD8DLDLt08JZrVq24sIYA6C7aTqzIUmBKNrsR/jWlbjsJJ3XpWLb7d4yhMVFwXV4WMNKPJ0ZkPi7hHO4IFlWVnwa12eXuPycZVn2/lXb3GM951MQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NoxO0uQ8p8+NwS/6qqqqqqqqqqqqqqqqqqqqpQhPSz//Nm+//O7v95vIkKq6rlvLCvS0LdhQz8WP/956+kiSC8/vX/XsXYlQKUpqVKjh2odVEMvu/uH8lAe0euKiUxtAQL0/Rai4eAM49HIPTYe38jnD6s/1KH//noyoLmFxVAPPot5RJW9stX/3jvV5LDXsMnoBcXcSPLsTalas3FmIWsd2VMQU1FMy4xMDBVVVVVVSCUmr9WgG1/4cu436iN5jtnjQCpm8kGPcasnSoVKGNTtu9+qr/x//NoxLshq0KuXMLLSiUwWoIwXgp8MfzWCMhQ2HjeWEB5nKvLAi2V7GAgaRxZQwhDZRLjCVAKSlV99F2O5L2HrvgxtV3Q9HA/d9fGcOk5bN18z801lp6P7rz+OG9G6u92NA0LIHyoeqF+Ps7DKxOsfZ6k1bucJVr2W+1WUxcpS2+rGN/lLfJPQqJM9EZRAWKTIcRFZgGvEzP4l8rWhZZYkLEA6OVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVACAL7ABCXfMLG+pzoaCpmcMdmmkA//NoxPEvIzqRvMsLjoAcSLZd2OPG3JNk3YGlS+M2d1YYS/WuyRlz/OVFqtSG2Hw82ZFZ5soCo2cNIYIMtEIFRJypCrpgOAZprAhhgF1gCgqFjV9GmkobI61am////5Ullri2YWJQWdYvlmskVi12ZhYOjiTBaHr6///+J2/Wo9fWfa5Ve///+Kjla2hjssg6BadhqqSAkf1ua9YMnmHQCVDRY8pMQU0gnauvvG2uAECzAwHjBExzgXmzQ7YwUeMCEQcBpzozGEARiomatXHONZlgehe6yKjX//NoxOArA1Z1nt4QfAKBwCMAqALDoourLsZK67QVModbisLIIIiEpW8ul03djBWEAKOuvRHq3V79V3PWtZhym7N47/Mz212ZmZmcm8/1qKz9fH/tlcnqKdde8YJSez7BgJCkQwJiOeUbffKgNFGL17a9szfykzOUv890zlKTMzmr3/2ecYPIX2Irzixyadu/zCzn+cnvp2Tt8pq8qH1h7//+QnEercm7f9R+rS2Y+oYI5U0LyAw4UAi6vn9LGAj+IAlLNp0zVsO0DQZqMUzkFrGuxlFiDqXL//NoxPwx80ZYCu7YXFy6kADKK3NOACAMG4dROYbGwZDJeW01rTU6ybuZUS5quEW//93/GozD9d3ZlMqfWnq1c4ek6GLV3Zh5m8PUy7W4wplUNs9j7tx54mRt3hiq/VC90zMS9+42wdx44yhqtR6GsSbKZkcQQzTHa3T0bvRRu6tjyMHi62GusLX0qqs2Yh9or6O22VTlCxEMvWztlDgxhuzPk0ELVB1rJWNHccCILBwFMSG9q66ZiSKC8y+jVVb25M4htSuFqVtP3chuRWYYs0sX1WnM8MrP//NoxP9F7BZ0XtrxMC/hrV6/+t5crU8zIqeZhyV2Ik/s5C2iJMKQRuSXaJR26/vM6l9wTOvDhITlz+ZRxLM0RYOfynv15I2zFE5GWPvavUsRay87twPHJzsSl12tG5XThZhoSSQBCEQwU8X9u9adyPEd995Z7/9//2/1m///8S77d3dhh4WWxOkC+ZNEEELw1ogpVsfwDmUexKdpTdlGtXLVhNMRAUEiypDfaacixa09C4WfJAjNAoYlg6RmaYeRKHgslQdWXS7Yei3NxoRcGQLJDsTRDSLx//NoxLI0jBalvsmZVuR1bO2L6qxrV58pKUu783p9MpNdvM3vbHfz2oXEp4YRVWAArcrAB/3e+5V32bOxcjIzdhkhv4T60Uvl/QdK7fN/WdlL1qzbPI7b/u3L4PcJ+oJYAyOAmWUVPBcbKzzLVX+nYZONrGd3cWMHBgBBlFMn7igkCQtuVEOOk2iodn52XCyDdccFQf8mdXwLHTBRZTGoeaWtLefUL7Xl44Xn9lvxRw0luKZR9lZtfSnTo9lyEUIysBGKZQNRQYQ5U0djkXa////9FoZVaVMh//NoxKosLBaVnMMFViq7I7zhg7JMAUIGO1AEGZc/L5jlb7KlRgnHXSgfPAoFONVT/uUzAmnpYGtLfV7f/3/sQUxAKhLfvPq2/NxaTWV6qOjwjYpI0BLak/lrlrbSkr0RGtrwX05vJW+zXoGcFdrptMYu4j2TlBXfV/rcZmvK4YCFBRMBDBWKXoBFQ10NoYqKx0MAlMGcv/7I/Xr/ciqrdJrslAomxjOUpVZ99K2IZ6sjP///or1JpVbSy7bgg0CBVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVV//NoxMQrDBaaXs4EvlVVVVVVVVVVbSFmd7+xyanu/r7tzmUunVrhR6TV5UbYmn/+XO3o2ITQu3Yw/9Y7yo0ELtUxD07vhMPJAAjCCNTv1niSaIGIUjGpbLb0UqJABxWdj/v1SaYk6+/z0kCQSf/qUxn/oYPBIDCz7r4IJl/TsiUTbYeAw8dGGR3F3Nf6mW6UM+yUctA9NihIO1D3EXaPPL0dZlVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//NoxMMjkzaqPsLLMnCA0H1/1cvNmedUs3mZsKaB0C3MbMe36Ntl4AUdaUnrsGERUAIJAHm+tOtr1jjYnPwF27D72l+3WSutysWLKNkcsOHx9k3tMt/EPMjhwjM44w4CbzvY9n7M7PPMdVLdmOQ5QoCUGZD2vv/RXhQaOZgNAYsDOwd7d26dL38cyRwQuoZ3ZkZ3b2alGN2ZPQKNx6s4NFD8YypMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqpAKckJKl3n186GjR4KppnNm/kdqDO4TACS//NoxMsli86qPosEv+XyNyo/WxQRSsvS4MCvAXnMks4nDAFBW4s4aoQWNM4ECAxtllK1+OK4Xc0ocwDYobEhEm1KokKSMkCyIBiLtKNK47oqTy4x9dtGc6DJR6NeaV4ijCJVKShBVf/2q1HRjKc449qu60RyDLDo5RwiBhUw8qnKurvojLRpi0M0Qi5UDWONgGNVRMUUK3l/U0VOqrhwiKqOgBUBxu1TRl76ROow8OjJUaPJR8zGTCECJgoIBCPzSLbOs/s1n7jkJoNY3BW1wkfBEUORENTN//NoxOQr+1583spLLjyQzOFTOrD5rjIpjaDDZywuqITpmhKhLZxo0EC4g+tJcoIlAcbggikAZo0kg1LqFFLO7XXOsq+GnN/F88fN1VzVvq6qK+YunxF1DWxH//8fxzLt1SpBScDwPpmp6z5MLeaGpc6BAS8gRQMx3AhAPiaORBonT5aavVVZfFRKqZ1YpVh0H3PY9t2dtE81E7TWGVdPj13Gjy7v/hZMQU1FMy4xMDBVVVVVVVVVLuwYPlrxSCgBAQMCJI3EpQMRCABGBwYDAKYlHZpWSmIl//NoxP8zg4JYGOaWsKGkxMYOEsPl+TguzDnDRKzMB0NINCpsy6Uwtkx1A5641pICjAEEMIGRtLrNNV071FYhihwclLLDUKa1amHzUHMiQ9rDQ0237daXSs1b1LTV/Cqmo/eL459/////+q/k8HBEFbmXu3SmEQwcUIQiA3DsCSAlAjAKBYSCZBY0uV+MyNr9cZNc6xBaCAwwXJgEGSJbVs//LihMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NoxOwt+ypgGuaQrKqqqqpDYB7tt3/buePRgQ2A28txdEKhNjAWiZzBDMUcACu2sZ58fcdXLOaOWzCcjvuqsVWA+fQeupx+pydXkJbFT23nZ68BwzfWr/E856lGf2Z0ZHMZKsYi25mNGORXPea3//2uY1EVzmY+YlyE5tY4PxGGhcfEYdJAYiGIztVPo/tplbvmWV3POdCZ7r5tvv///+rSp6pMQU1FMy4xMDCqqqqqqqqqqqqgApbbLVq1euPiI5hqQLBnhuwSvI2wd9qe08aEw0LCBZZD//NoxMcktA6RnMsPDpKlOxYY2sDRClW0Y8JLWl15M0hBx+6ekk76uivf7UN06xIBk9FqPRyW2rSxqSR/XLKJ6yakKSUZy38mkXw/XfbI6dMX/GdOZ7e3UKbVPr2mp/7P2ypVO3fCthgfNXn83bOttdELr0YRZasgS0WD6fThJtsfVzcf1/19RuIx1QrOB2ExcGUQK9UHJbrs9P/6+mpB40aDKBJMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NoxO0uNBZ4/NLLeqqqqqqqqqqqqqqqqqqSqh5v9JJMv/8UligWsKlVoyZ0Ys58ZEAEubFJVL7cWjEb/93b34X6/a8clLJ6F/Ie73LzA/73Gv5LSIlJSrSSXGhHPIRUEyaxCew92sjnf0fkKqt2G66d0txrK9zhYwLaKalZyJmEiujuNDhxQSQy2XT//1VjFzOw0iKMEhYaRBAzaxi3f7t50tVMQU1FMy4xMDBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV//NoxL4iW1ahnsGLRlVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV56aO3fyW6vVoASiAUyUE0I4WakV1VDlNspPTaMjzy0tyTMmgoTGmUGn0ApJTK8/TzyqyKokqy0pb+3nMm1rN/WPjAKYo8jVfz5MzKS8v/q3KralpUoCJZOnUrGU2pShWNUSWApH9lR0ShIGjzVD5YqRaAQ1uZ57wkHVMQU1FMy4xMDBVVVVVVVVVVVUH0k4+bo7p2rAFo30anmoXJDjqTz9kFuZSXVQpTSUuQmqh//NoxK4ecrqZnkjFioeXiwMHBX0XCMZDbo+yNqE2S9xlYGSgUCsN4mHlsSyKAZiSJy1m4tq7Uap3CYk70PBVE0IAgIlmY12YEKbsPjGQpVU1jL6ghhTMFjiB1pHGO8Ygx/wu+GMm7AwEahnaCqFQUBAQ1JmCqjKAoZMx9Gq8PmzHxY3NW/pwKUbqKrUS3SAZHUiUNDI9VhhYanM/6kPUsjh0FOpMQU1FMy4xMDCqqqqqqqqqqgYJuNtyELtikaBEPNoQGG0CM8ieQrmURVQ+GQsMiEPHQ8Ni//NoxO0uHA4kFn4GtYJzKJkVHYTqbkVNIVGmiFhq4NRkQnG0jj0KE4aQ4rMUnB4UqThKkSYYkWqv6LUSucJHWRKJORMCjl48sScjZHKpzVAyBK58nabTosk8trt/JSYSDGB0f6fCTV5bYWCiUAp5bZZt/mCTouiyU/+TYJFo1UsyRuEryW8gyZFjlkbIts1ctMlEhIYBJkaciolZHKkpfoSgAgNMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NoxO4uhBXk3kpMvKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NoxDQAAANIAAAAAKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NoxDQAAANIAAAAAKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NoxDQAAANIAAAAAKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NoxDQAAANIAAAAAKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NoxDQAAANIAAAAAKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NoxDQAAANIAAAAAKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NoxDQAAANIAAAAAKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NoxDQAAANIAAAAAKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NoxDQAAANIAAAAAKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NoxDQAAANIAAAAAKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqpMQU1FMy4xMDCqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//NoxDQAAANIAAAAAKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"
                                }]

                        }]
                }

                const pcmBase64 = jsonData.tracks[0].audio[0].pcm;
                addLog(`获取到PCM数据，长度: ${pcmBase64.length}字符`);

                // 2. 解码Base64为二进制数据
                const pcmData = base64ToArrayBuffer(pcmBase64);
                addLog(`Base64解码成功，PCM数据大小: ${pcmData.byteLength}字节`);

                // 3. 转换为WAV格式
                const wavBuffer = encodeWAV(pcmData);
                addLog(`转换为WAV格式成功，WAV大小: ${wavBuffer.byteLength}字节`);

                // 4. 创建AudioContext并解码
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
                audioBuffer = await audioContext.decodeAudioData(wavBuffer);
                addLog("音频解码成功，准备播放");

                // 5. 显示音频时长
                durationTimeEl.textContent = formatTime(audioBuffer.duration);

                // 6. 启用停止按钮
                stopBtn.disabled = false;

                // 7. 播放音频
                playAudio();

            } catch (error) {
                console.error("解码或播放错误:", error);
                addLog(`错误: ${error.message}`);
                updateStatus(`错误: ${error.message}`, "error");
            }
        });

        // 播放音频函数
        function playAudio() {
            if (!audioContext || !audioBuffer) {
                updateStatus("音频数据未准备好", "error");
                addLog("播放失败: 音频数据未准备好");
                return;
            }

            // 停止当前播放（如果有）
            if (audioSource) {
                audioSource.stop();
            }

            // 创建新的音频源
            audioSource = audioContext.createBufferSource();
            audioSource.buffer = audioBuffer;

            // 设置音量控制
            const gainNode = audioContext.createGain();
            gainNode.gain.value = volumeControl.value;

            // 连接节点
            audioSource.connect(gainNode);
            gainNode.connect(audioContext.destination);

            // 添加事件监听
            audioSource.onended = () => {
                isPlaying = false;
                updateStatus("播放完成", "success");
                addLog("播放完成");
                stopBtn.disabled = true;
                progressBar.style.width = '100%';
                currentTimeEl.textContent = formatTime(audioBuffer.duration);
            };

            // 开始播放
            audioSource.start(0);
            isPlaying = true;

            // 更新时间显示
            updateStatus("正在播放音频...", "processing");
            addLog("开始播放音频");

            // 更新进度条
            function updateProgress() {
                if (!isPlaying) return;

                const currentTime = audioContext.currentTime;
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / audioBuffer.duration, 1);

                progressBar.style.width = `${progress * 100}%`;
                currentTimeEl.textContent = formatTime(elapsed);

                if (progress < 1) {
                    requestAnimationFrame(updateProgress);
                }
            }

            const startTime = audioContext.currentTime;
            updateProgress();
        }

        // 停止播放
        stopBtn.addEventListener('click', () => {
            if (audioSource) {
                audioSource.stop();
                isPlaying = false;
                updateStatus("播放已停止", "success");
                addLog("用户停止播放");
                stopBtn.disabled = true;
            }
        });

        // 音量控制
        volumeControl.addEventListener('input', () => {
            const volume = volumeControl.value;
            volumeValue.textContent = `${Math.round(volume * 100)}%`;

            if (audioContext && audioSource) {
                const gainNode = audioContext.createGain();
                gainNode.gain.value = volume;

                // 重新连接节点
                audioSource.disconnect();
                audioSource.connect(gainNode);
                gainNode.connect(audioContext.destination);
            }

            addLog(`音量调整为: ${Math.round(volume * 100)}%`);
        });
    });
</script>
</body>
</html>